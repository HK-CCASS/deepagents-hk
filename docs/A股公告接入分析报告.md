# A股公告接入分析报告

> 分析日期: 2025-11-25

## 📋 目录

1. [重构范围总览](#重构范围总览)
2. [数据源对比分析](#数据源对比分析)
3. [巨潮资讯API接口文档](#巨潮资讯api接口文档)
4. [推荐实施方案](#推荐实施方案)
5. [工作量评估](#工作量评估)

---

## 重构范围总览

### 影响层级

| 层级 | 影响程度 | 需要变更 |
|------|----------|----------|
| **服务层** | 🔴 高 | 新增 A股 API 服务 |
| **工具层** | 🔴 高 | 新增 A股工具集 |
| **配置层** | 🟡 中 | 扩展市场配置 |
| **提示词** | 🟡 中 | 双市场提示词 |
| **存储层** | 🟢 低 | 目录结构调整 |
| **代理层** | 🟢 低 | 工具注册扩展 |

### 港股与A股差异

| 特性 | 港股 (HKEX) | A股 |
|------|-------------|-----|
| 股票代码 | 5位 (00673) | 6位 (600519) |
| 市场划分 | SEHK/GEM | 上交所/深交所 |
| API格式 | JSONP | JSON |
| 日期格式 | dd/mm/yyyy | YYYY-MM-DD |

---

## 数据源对比分析

### 三种数据源方案

| 维度 | 上交所官网 | 深交所官网 | 巨潮资讯 |
|------|-----------|-----------|---------|
| **覆盖范围** | 仅上交所股票 | 仅深交所股票 | 全部A股 + 港股 ⭐ |
| **API稳定性** | ❌ 返回"系统繁忙" | ❌ 返回500错误 | ✅ 稳定可用 |
| **反爬机制** | 🔴 严格 | 🔴 严格 | 🟡 相对宽松 |
| **开发成本** | 需2套API | 需2套API | 仅需1套API ⭐ |
| **数据时效** | 实时 | 实时 | 准实时 (约延迟5-30分钟) |

### 测试结果

| 数据源 | 测试URL | 结果 |
|--------|---------|------|
| **上交所** | `query.sse.com.cn/...` | ❌ `{"error":"系统繁忙..."}` |
| **深交所** | `szse.cn/api/disc/...` | ❌ `HTTP 500` |
| **巨潮资讯** | `cninfo.com.cn/new/fulltextSearch/...` | ✅ 正常返回JSON |

### 为什么不用上交所+深交所？

1. **反爬虫机制严格** — 需要特定请求头、Cookie
2. **需要维护两套独立系统** — 不同的请求/响应格式
3. **巨潮资讯优势** — 统一接口覆盖所有市场

### 巨潮资讯背景

- **官方地位**: 深交所全资子公司
- **指定披露**: 中国证监会指定信息披露网站
- **数据来源**: 直接从两所获取官方数据

---

## 巨潮资讯API接口文档

### 1. 全文搜索接口 ✅

**URL**: `https://www.cninfo.com.cn/new/fulltextSearch/full`

**方法**: `GET`

**参数**:

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `searchkey` | string | 是 | 搜索关键词（股票代码/名称/内容） |
| `sdate` | string | 否 | 起始日期 (YYYY-MM-DD) |
| `edate` | string | 否 | 结束日期 (YYYY-MM-DD) |
| `isfulltext` | boolean | 否 | 是否全文搜索 (false) |
| `sortName` | string | 否 | 排序字段 (time/nothing) |
| `sortType` | string | 否 | 排序方式 (desc/asc) |
| `pageNum` | int | 是 | 页码 (从1开始) |
| `pageSize` | int | 是 | 每页数量 (1-50) |

**响应示例**:

```json
{
  "totalAnnouncement": 1209,
  "totalRecordNum": 1209,
  "hasMore": true,
  "totalpages": 120,
  "announcements": [
    {
      "secCode": "600519",
      "secName": "贵州茅台",
      "orgId": "gssh0600519",
      "announcementId": "1224825591",
      "announcementTitle": "贵州茅台关于...",
      "announcementTime": 1764086400000,
      "adjunctUrl": "finalpage/2025-11-26/1224825591.PDF",
      "adjunctSize": 90,
      "adjunctType": "PDF",
      "pageColumn": "SHZB",
      "announcementType": "01010503||010113",
      "shortTitle": "..."
    }
  ]
}
```

### 2. 深交所股票列表 ✅

**URL**: `https://www.cninfo.com.cn/new/data/szse_stock.json`

**响应示例**:

```json
{
  "stockList": [
    {
      "code": "000001",
      "pinyin": "payh",
      "category": "A股",
      "orgId": "gssz0000001",
      "zwjc": "平安银行"
    }
  ]
}
```

### 3. PDF下载地址

**格式**: `https://static.cninfo.com.cn/{adjunctUrl}`

**示例**: `https://static.cninfo.com.cn/finalpage/2024-12-28/1222168018.PDF`

### 市场代码映射 (pageColumn)

| pageColumn | 含义 |
|------------|------|
| `SHZB` | 上海主板 (A股) |
| `SZZB` | 深圳主板 (A股) |
| `SZCY` | 深圳创业板 (A股) |
| `HKZB` | 香港主板 (港股) ⭐ |
| `HKCY` | 香港创业板 (港股) ⭐ |

### 组织ID (orgId) 格式

| 前缀 | 市场 |
|------|------|
| `gssh0` | 上交所 (如 `gssh0600519`) |
| `gssz0` | 深交所 (如 `gssz0000858`) |
| `gshk0` | 港交所 (如 `gshk0002322`) |

---

## 推荐实施方案

### 方案对比

| 方案 | 实现复杂度 | 维护成本 | 数据覆盖 | 推荐度 |
|------|-----------|---------|---------|--------|
| 上交所+深交所+HKEX | 🔴 高 | 🔴 高 | ✅ 完整 | ⭐⭐ |
| 巨潮+HKEX | 🟡 中 | 🟡 中 | ✅ 完整 | ⭐⭐⭐ |
| **仅巨潮** | 🟢 低 | 🟢 低 | ✅ 完整 | ⭐⭐⭐⭐⭐ |

### 推荐: 采用巨潮资讯作为统一数据源

**原因**:

1. ✅ 接口稳定 — 实测可用，无需绕过反爬
2. ✅ 覆盖完整 — A股(上交所+深交所) + 港股
3. ✅ 开发简单 — 只需实现一套API服务
4. ✅ 官方背景 — 深交所全资子公司，数据可信
5. ✅ 维护成本低 — 单一数据源，统一格式

**待验证**: 港股数据的时效性和完整性是否满足需求

---

## 工作量评估

### 重构任务清单

| 优先级 | 任务 | 工作量 |
|--------|------|--------|
| P0 | 新建 `cninfo_api.py` 服务 | 3-4天 |
| P0 | 新建 `cninfo_tools.py` 工具 | 1-2天 |
| P1 | 修改 `agent_config.py` 配置 | 0.5天 |
| P1 | 修改 `main_system_prompt.md` | 1天 |
| P2 | 修改 `pdf_tools.py` 支持市场参数 | 0.5天 |
| P2 | 调整缓存目录结构 | 0.5天 |
| P3 | 迁移现有港股数据到新目录 | 0.5天 |
| P3 | 更新测试用例 | 1-2天 |

**总计**: 约 8-11 天工作量

### 关键风险点

1. **巨潮API稳定性** — 可能需要反爬处理
2. **A股PDF格式** — 与港股可能有差异
3. **公告分类映射** — A股与港股分类体系不同
4. **港股数据时效** — 需验证是否有延迟

---

## 附录: 代码结构规划

### 新增文件

```
src/
├── services/
│   └── cninfo_api.py      # 新增: 巨潮资讯API服务
├── tools/
│   └── cninfo_tools.py    # 新增: A股公告工具
└── config/
    └── agent_config.py    # 修改: 扩展市场配置
```

### 目录结构调整

```
pdf_cache/
├── hk/                    # 港股 (原 00xxx/ 移入)
│   ├── 00673/
│   └── 00875/
└── cn/                    # A股 (新增)
    ├── 600519/
    └── 000858/
```

---

*文档生成时间: 2025-11-25*





